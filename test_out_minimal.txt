============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.2, pluggy-1.6.0
PyQt6 6.10.2 -- Qt runtime 6.10.2 -- Qt compiled 6.10.0
rootdir: /home/schnebeck/Dokumente/Projects/KPaperFlux
configfile: pytest.ini
plugins: dash-3.2.0, qt-4.5.0, anyio-4.9.0, typeguard-4.1.5, hypothesis-6.98.15
collected 1 item

../../../Dokumente/Projects/KPaperFlux/tests/gui/test_document_list_minimal.py [DEBUG] Standard View returned 1 documents.
[DEBUG] refresh_list: Initial population (1 documents).
[DEBUG] Standard View returned 1 documents.
TEST DEBUG: dynamic_columns: ['sender_name']
TEST DEBUG: Headers: ['#', 'Entity ID', 'Filename', 'Pages', 'Imported Date', 'Used Date', 'Deleted Date', 'Locked Date', 'Autoprocessed Date', 'Exported Date', 'Status', 'Type Tags', 'Tags', 'Sender']
TEST DEBUG: Col 0 (#): ''
TEST DEBUG: Col 1 (Entity ID): 'uuid-1'
TEST DEBUG: Col 2 (Filename): 'invoice.pdf'
TEST DEBUG: Col 3 (Pages): '0'
TEST DEBUG: Col 4 (Imported Date): '03.02.2026 22:43:34'
TEST DEBUG: Col 5 (Used Date): '-'
TEST DEBUG: Col 6 (Deleted Date): '-'
TEST DEBUG: Col 7 (Locked Date): '-'
TEST DEBUG: Col 8 (Autoprocessed Date): '-'
TEST DEBUG: Col 9 (Exported Date): '-'
TEST DEBUG: Col 10 (Status): 'NEW'
TEST DEBUG: Col 11 (Type Tags): ''
TEST DEBUG: Col 12 (Tags): ''
TEST DEBUG: Col 13 (Sender): '2023-01-01'
F

=================================== FAILURES ===================================
________________________ test_document_list_population _________________________

qtbot = <pytestqt.qtbot.QtBot object at 0x709f072baab0>
mock_db = <MagicMock id='123828352213952'>

    def test_document_list_population(qtbot, mock_db):
        """Test that the list widget populates correct data from DB."""
        # Data Setup
        docs = [
            Document(
                uuid="uuid-1",
                original_filename="invoice.pdf",
                semantic_data=SemanticExtraction(**{
                    "meta_header": {
                        "sender": {"name": "Amazon"},
                        "doc_date": "2023-01-01"
                    }
                })
            )
        ]
    
        mock_db.get_all_documents.return_value = docs
        mock_db.get_all_entities_view.return_value = docs
    
        widget = DocumentListWidget(db_manager=mock_db)
        # FORCING FRESH STATE
        widget.dynamic_columns = ["sender_name"]
        widget.update_headers()
    
        qtbot.addWidget(widget)
        widget.refresh_list()
    
        print(f"TEST DEBUG: dynamic_columns: {widget.dynamic_columns}")
    
        item = widget.item(0) # row 0
        header_labels = [widget.tree.headerItem().text(i) for i in range(widget.tree.columnCount())]
        print(f"TEST DEBUG: Headers: {header_labels}")
    
        sender_col = header_labels.index("Sender")
    
        for i in range(widget.tree.columnCount()):
            print(f"TEST DEBUG: Col {i} ({header_labels[i]}): '{item.text(i)}'")
    
>       assert item.text(sender_col) == "Amazon"
E       AssertionError: assert '2023-01-01' == 'Amazon'
E         
E         - Amazon
E         + 2023-01-01

../../../Dokumente/Projects/KPaperFlux/tests/gui/test_document_list_minimal.py:51: AssertionError
=========================== short test summary info ============================
FAILED ../../../Dokumente/Projects/KPaperFlux/tests/gui/test_document_list_minimal.py::test_document_list_population
============================== 1 failed in 1.23s ===============================
